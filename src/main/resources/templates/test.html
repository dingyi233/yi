<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>排课系统</title>
    <!-- vue -->
<!--&lt;!&ndash;    <script src="js/vue.js"></script>&ndash;&gt;-->
<!--    &lt;!&ndash; 引入样式 &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
<!--    &lt;!&ndash; 引入组件库 &ndash;&gt;-->
<!--    <script src="https://unpkg.com/element-ui/lib/index.js"></script>-->
<!--    <script src="https://unpkg.com/vue/dist/vue.js"></script>-->
    <!-- 引入样式 -->
    <script src="./js/vue.js"></script>
<!--        <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
    <link rel="stylesheet" href="./css/element.css">
    <!-- 引入组件库 -->
    <script src="./js/element.js"></script>
</head>
<body>
<div id="app">
    <el-row v-if="this.selectedData.length === 0">
        <el-col :span="6"><br/></el-col>
        <el-col :span="12" class="card">
            <h1>选择课程</h1>
            <el-table
                    :data="tableData"
                    style="width: 100%">
                <el-table-column
                        prop="courseId"
                        label="课程代号">
                </el-table-column>
                <el-table-column
                        prop="name"
                        label="课程名称">
                </el-table-column>
                <el-table-column
                        prop="type"
                        label="课程类型">
                </el-table-column>
                <el-table-column
                        prop="studyTime"
                        label="课程学时">
                </el-table-column>
                <el-table-column
                        prop="credit"
                        label="课程学分">
                </el-table-column>
                <el-table-column
                        label="选择">
                    <template slot-scope="scope">
                        <el-checkbox v-model="scope.row.checked">选择该课程</el-checkbox>
                    </template>
                </el-table-column>
            </el-table>
            <br/>
            <div style="float: right">
                本学期总周数：
                <el-select v-model="term" style="width: 20%;" placeholder="请选择">
                    <template slot="prepend">设置学期周数</template>
                    <el-option
                            v-for="item in terms"
                            :key="item"
                            :label="item"
                            :value="item">
                    </el-option>
                    <template slot="append">周</template>
                </el-select>
                周
                <br/>
            </div>
            <br/>
            <br/>
            <br/>
            <el-button type="primary" style="width: 100%" round v-on:click="selectCourse">开始排课</el-button>
        </el-col>
        <el-col :span="6"></el-col>
    </el-row>

    <el-row v-if="this.selectedData.length !== 0">
        <el-col :span="3"><br/></el-col>
        <el-col :span="18" class="card">
            <h1>选择上课时间</h1>
            <el-row>
                <el-col :span="3" class="block"><br/></el-col>
                <el-col :span="3" class="block">星期一</el-col>
                <el-col :span="3" class="block">星期二</el-col>
                <el-col :span="3" class="block">星期三</el-col>
                <el-col :span="3" class="block">星期四</el-col>
                <el-col :span="3" class="block">星期五</el-col>
                <el-col :span="3" class="block">星期六</el-col>
                <el-col :span="3" class="block">星期日</el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第一大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c1.courseId}}<br/>{{this.schedulingData.d1.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c1.courseId}}<br/>{{this.schedulingData.d2.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c1.courseId}}<br/>{{this.schedulingData.d3.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c1.courseId}}<br/>{{this.schedulingData.d4.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c1.courseId}}<br/>{{this.schedulingData.d5.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c1.courseId}}<br/>{{this.schedulingData.d6.c1.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,1)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c1.courseId}}<br/>{{this.schedulingData.d7.c1.name}}</div>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第二大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c2.courseId}}<br/>{{this.schedulingData.d1.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c2.courseId}}<br/>{{this.schedulingData.d2.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c2.courseId}}<br/>{{this.schedulingData.d3.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c2.courseId}}<br/>{{this.schedulingData.d4.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c2.courseId}}<br/>{{this.schedulingData.d5.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c2.courseId}}<br/>{{this.schedulingData.d6.c2.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,2)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c2.courseId}}<br/>{{this.schedulingData.d7.c2.name}}</div>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第三大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c3.courseId}}<br/>{{this.schedulingData.d1.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c3.courseId}}<br/>{{this.schedulingData.d2.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c3.courseId}}<br/>{{this.schedulingData.d3.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c3.courseId}}<br/>{{this.schedulingData.d4.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c3.courseId}}<br/>{{this.schedulingData.d5.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c3.courseId}}<br/>{{this.schedulingData.d6.c3.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,3)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c3.courseId}}<br/>{{this.schedulingData.d7.c3.name}}</div>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第四大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c4.courseId}}<br/>{{this.schedulingData.d1.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c4.courseId}}<br/>{{this.schedulingData.d2.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c4.courseId}}<br/>{{this.schedulingData.d3.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c4.courseId}}<br/>{{this.schedulingData.d4.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c4.courseId}}<br/>{{this.schedulingData.d5.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c4.courseId}}<br/>{{this.schedulingData.d6.c4.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,4)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c4.courseId}}<br/>{{this.schedulingData.d7.c4.name}}</div>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第五大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c5.courseId}}<br/>{{this.schedulingData.d1.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c5.courseId}}<br/>{{this.schedulingData.d2.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c5.courseId}}<br/>{{this.schedulingData.d3.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c5.courseId}}<br/>{{this.schedulingData.d4.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c5.courseId}}<br/>{{this.schedulingData.d5.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c5.courseId}}<br/>{{this.schedulingData.d6.c5.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,5)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c5.courseId}}<br/>{{this.schedulingData.d7.c5.name}}</div>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="3" class="block">第六大节</el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(1,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d1.c6.courseId}}<br/>{{this.schedulingData.d1.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(2,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d2.c6.courseId}}<br/>{{this.schedulingData.d2.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(3,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d3.c6.courseId}}<br/>{{this.schedulingData.d3.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(4,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d4.c6.courseId}}<br/>{{this.schedulingData.d4.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(5,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d5.c6.courseId}}<br/>{{this.schedulingData.d5.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(6,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d6.c6.courseId}}<br/>{{this.schedulingData.d6.c6.name}}</div>
                </el-col>
                <el-col :span="3" class="block">
                    <el-button type="text" v-on:click="openDrawer(7,6)">选择课程</el-button>
                    <div>{{this.schedulingData.d7.c6.courseId}}<br/>{{this.schedulingData.d7.c6.name}}</div>
                </el-col>
            </el-row>
            <br/>
            <el-button type="primary" style="width: 100%" round v-on:click="submit">提交</el-button>
        </el-col>
        <el-col :span="3"></el-col>
    </el-row>
    <el-drawer
            :visible.sync="drawer"
            :with-header="false"
            direction="rtl"
            size="60%">
        <el-row>
            <el-col :span="1"><br/></el-col>
            <el-col :span="22">
                <h1>选择课程</h1>
                <h3>星期{{this.currD === 7 ? "日":this.currD}} - 第{{this.currC}}大节课</h3>
                <el-table
                        :data="selectedData"
                        style="width: 100%;">
                    <el-table-column
                            prop="courseId"
                            label="课程代号">
                    </el-table-column>
                    <el-table-column
                            prop="name"
                            label="课程名称">
                    </el-table-column>
                    <el-table-column
                            prop="type"
                            label="课程类型">
                    </el-table-column>
                    <el-table-column
                            prop="studyTime"
                            label="课程学时">
                    </el-table-column>
                    <el-table-column
                            prop="credit"
                            label="课程学分">
                    </el-table-column>
                    <el-table-column
                            prop="lessWeek"
                            label="剩余可选">
                    </el-table-column>
                    <el-table-column
                            label="选择">
                        <template slot-scope="scope">
                            <el-button type="success" round v-on:click="choice(scope.row)">选择该课程</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <br/>
                <el-button type="warning" style="width: 100%" round v-on:click="remove">清除该位置课程</el-button>
            </el-col>
            <el-col :span="1"><br/></el-col>
        </el-row>
    </el-drawer>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            tableData: [],
            selectedData: [],
            drawer: false,
            schedulingData: {},
            currD: 0,
            currC: 0,
            terms: [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
            term: 16,
        },
        created() {
            var schedulingData = {}
            for (var d = 1; d <= 7; d++) {
                schedulingData["d" + d] = {};
                for (var c = 1; c <= 6; c++) {
                    schedulingData["d" + d]["c" + c] = {}
                }
            }
            console.log(schedulingData)
            this.schedulingData = schedulingData
            this.tableData = [
                {
                    "courseId": "CST1",
                    "name": "课程 1",
                    "type": "垃圾课程",
                    "studyTime": 24,
                    "credit": 24,
                },
                {
                    "courseId": "CST2",
                    "name": "课程 2",
                    "type": "狗屎课程",
                    "studyTime": 48,
                    "credit": 12,
                },
                {
                    "courseId": "CST3",
                    "name": "课程 3",
                    "type": "垃圾课程",
                    "studyTime": 24,
                    "credit": 24,
                },
                {
                    "courseId": "CST4",
                    "name": "课程 4",
                    "type": "狗屎课程",
                    "studyTime": 48,
                    "credit": 12,
                },
                {
                    "courseId": "CST5",
                    "name": "课程 5",
                    "type": "垃圾课程",
                    "studyTime": 72,
                    "credit": 24,
                },
                {
                    "courseId": "CST6",
                    "name": "课程 6",
                    "type": "狗屎课程",
                    "studyTime": 148,
                    "credit": 12,
                }
            ]
        },
        methods: {
            selectCourse() {
                var select = []
                for (var i in this.tableData) {
                    if (this.tableData[i].checked === true) {
                        select.push(this.tableData[i])
                    }
                }
                // 是否选了
                if (select.length === 0) {
                    this.$alert('请至少选择一门课程', '注意', {
                        confirmButtonText: '确定',
                    });
                    return;
                }
                // 判断时间是否够
                var term = this.term;
                var totalCell = 0;
                for (var i in select) {
                    // 一周需要上几次
                    select[i]["lessWeek"] = Math.ceil(Math.ceil(select[i]["studyTime"] / 2) / term)
                    totalCell += select[i]["lessWeek"];
                }
                if (totalCell > 42) {
                    this.$alert('课程总时长过长', '注意', {
                        confirmButtonText: '确定',
                    });
                    return;
                }
                this.selectedData = select;
            },

            openDrawer(d, c) {
                this.currD = d;
                this.currC = c;
                this.drawer = true;
            },

            choice(row) {
                var schedulingData = this.schedulingData
                // 剩余周数是否足够
                if (row.lessWeek <= 0) {
                    this.$alert('该课程时间已被安排完毕', '注意', {
                        confirmButtonText: '确定',
                    });
                    return;
                }
                // 是否为当前课
                if (schedulingData["d" + this.currD]["c" + this.currC] === row) {
                    this.$alert('该位置已经选择了该课程', '注意', {
                        confirmButtonText: '确定',
                    });
                    return;
                }
                // 将原来的课的周数增加
                if (schedulingData["d" + this.currD]["c" + this.currC].lessWeek !== null) {
                    schedulingData["d" + this.currD]["c" + this.currC].lessWeek++
                }
                // 减学时
                row.lessWeek--
                // 设置
                schedulingData["d" + this.currD]["c" + this.currC] = row
                this.schedulingData = schedulingData
                this.drawer = false;
            },
            remove() {
                var schedulingData = this.schedulingData
                schedulingData["d" + this.currD]["c" + this.currC].lessWeek++
                schedulingData["d" + this.currD]["c" + this.currC] = {}
                this.schedulingData = schedulingData
                this.drawer = false;
            },

            submit() {

            },
        }
    })
</script>

<style scoped>
    .block {
        border: 1px solid #c7c7c7;
        height: 85px;
        text-align: center;
        text-overflow: ellipsis;
        overflow: hidden;
        word-wrap: break-word;
    }

    .el-drawer__body {
        overflow: auto;
        /* overflow-x: auto; */
    }

    .card {
        margin: 10px;
        background-color: white;
        border-radius: 30px;
        padding: 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
    }
</style>

</body>
</html>